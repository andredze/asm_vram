Turbo Assembler	 Version 4.1	    02/11/26 22:40:36	    Page 1
vram.asm



      1	0000			     .model tiny
      2	0000			     .code
      3
      4				     org 100h
      5
      6				     ;//------------------------------------------------------------------------------------------
      7
      8	      =0050		     SCREEN_WIDTH    equ 80
      9	      =B800		     VIDEO_SEG		 equ 0b800h
     10
     11	      =0005		     FRAME_START_LINE equ 5
     12
     13	      =000F		     FRAME_COLOR	     equ 0Fh
     14	      =0028		     FRAME_WIDTH	     equ 40
     15	      =0006		     FRAME_HEIGHT    equ 6
     16
     17	      =00CD		     HORIZ_LINE		 equ 0cdh
     18	      =00BA		     VERT_LINE		 equ 0bah
     19	      =00C9		     LU_CORNER		 equ 0c9h
     20	      =00BB		     RU_CORNER		 equ 0bbh
     21	      =00C8		     LD_CORNER		 equ 0c8h
     22	      =00BC		     RD_CORNER		 equ 0bch
     23
     24	      =000C		     BRT_RED_CLR	 equ 0ch
     25	      =0080		     BLINKING		 equ 80h
     26
     27				     ;//------------------------------------------------------------------------------------------
     28
     29	0100			     Start:
     30	0100  B8 B800				     mov ax, VIDEO_SEG				     ; b800h - segment of vram
     31	0103  8E C0				     mov es, ax						     ; es - extended segment
     32
     33					     ; di = (center of start line)
     34	0105  BF 0370				     mov di, (2	* SCREEN_WIDTH * FRAME_START_LINE + SCREEN_WIDTH)
     35
     36	0108  57			     push di
     37	0109  E8 0026			     call DrawFrame
     38	010C  5F			     pop di
     39
     40	010D  81 C7 0140			     add di, (2	* SCREEN_WIDTH * ((FRAME_HEIGHT	- 1) / 2))   ; newline
     41
     42				     ;//------------------------------------------------------------------------------------------
     43				     ; get cmd line
     44
     45					     ; CX = CmdTailLen - 1 (for	the last \r)
     46	0111  BE 0080			     mov si, 80h
     47	0114  8A 0C			     mov byte ptr cl, [si]
     48
     49					     ; if CmdTailLen ==	0 -> jump to the end
     50	0116  E3 15			     jcxz LoadLineEnd
     51
     52	0118  49			     dec cx
     53
     54					     ; SI = &CmdTail
     55	0119  BE 0082			     mov si, 82h
     56
     57				     ;//------------------------------------------------------------------------------------------
Turbo Assembler	 Version 4.1	    02/11/26 22:40:36	    Page 2
vram.asm



     58				     ; center the text
     59
     60					     ; BX = shift to the left
     61					     ; BX = StringLen
     62	011C  8B D9			     mov bx, cx
     63
     64					     ; if CmdTailLen is	odd: bx++ (shift one more)
     65	011E  F7 C3 0001		     test bx, 01h
     66	0122  74 01			     jz	EvenLen
     67	0124  43			     inc bx
     68	0125				 EvenLen:
     69							     ; no need to div by 2, as there are 2 bytes in vram
     70	0125  2B FB				     sub di, bx		     ; di = center - shift
     71
     72				     ;//------------------------------------------------------------------------------------------
     73				     ; load the	text
     74
     75					     ; 2nd ax byte = color in vram
     76	0127  B4 8C				     mov ah, (BRT_RED_CLR or BLINKING)
     77
     78	0129				 LoadString:
     79
     80	0129  AC			     lodsb
     81	012A  AB			     stosw
     82
     83	012B  E2 FC			     loop LoadString
     84
     85	012D				 LoadLineEnd:
     86
     87				     ; end program
     88	012D  B8 4C00				     mov ax, 4c00h   ; exit(0)
     89	0130  CD 21				     int 21h		     ; int for DOS func	call
     90
     91				     ;//------------------------------------------------------------------------------------------
     92
     93				     ; function	should get di:
     94				     ; di = position in	vram in	the center of the DOS screen, where frame should start
     95				     ; ax, cx, di doesn't save their values
     96
     97	0132			     DrawFrame:
     98
     99					 ; 2nd ax byte = color in vram
    100	0132  B4 0F			 mov ah, FRAME_COLOR
    101
    102					 ; move	to the left side (a half of frame width)
    103					 ; not div 2, because 1	symbol = 2 bytes in vram
    104	0134  83 EF 28			 sub di, FRAME_WIDTH
    105
    106	0137  B0 C9			 mov al, LU_CORNER
    107	0139  AB			 stosw
    108
    109	013A  E8 001A			 call DrawHorizontalLine
    110
    111	013D  B0 BB			 mov al, RU_CORNER
    112	013F  AB			 stosw
    113
    114					 ; move	back to	the left side
Turbo Assembler	 Version 4.1	    02/11/26 22:40:36	    Page 3
vram.asm



    115					 ; and go to newline to	skip corner
    116	0140  83 C7 50			 add di, (-FRAME_WIDTH * 2 + SCREEN_WIDTH * 2)
    117
    118	0143  E8 0019			 call DrawVerticalLine
    119
    120	0146  B0 C8			 mov al, LD_CORNER
    121	0148  AB			 stosw
    122
    123	0149  E8 000B			 call DrawHorizontalLine
    124
    125	014C  B0 BC			 mov al, RD_CORNER
    126	014E  AB			 stosw
    127
    128					 ; +2 to get in	front of the corner
    129					 ; move	up below the right corner
    130					 ; -2 of height	to skip	the upper corner
    131	014F  81 EF 0282		 sub di, (2 + SCREEN_WIDTH * 2 * (FRAME_HEIGHT - 2))
    132
    133	0153  E8 0009			 call DrawVerticalLine
    134
    135	0156  C3			 ret
    136
    137				     ;//------------------------------------------------------------------------------------------
    138
    139	0157			     DrawHorizontalLine:
    140
    141					 ; 1st ax byte = symbol
    142	0157  B0 CD			 mov al, HORIZ_LINE
    143	0159  B9 0026			 mov cx, (FRAME_WIDTH -	2)
    144	015C  F3> AB			 rep stosw
    145
    146	015E  C3			 ret
    147
    148				     ;//------------------------------------------------------------------------------------------
    149
    150	015F			     DrawVerticalLine:
    151
    152					 ; 1st ax byte = symbol
    153	015F  B0 BA			 mov al, VERT_LINE
    154	0161  B9 0004			 mov cx, (FRAME_HEIGHT - 2)
    155
    156	0164				 VerticalLineLoop:
    157	0164  26: 89 05			 mov es:[di], ax
    158	0167  81 C7 00A0		 add di, (SCREEN_WIDTH * 2)
    159
    160	016B  E2 F7			 loop VerticalLineLoop
    161
    162	016D  C3			 ret
    163
    164				     ;//------------------------------------------------------------------------------------------
    165
    166				     end	     Start
Turbo Assembler	 Version 4.1	    02/11/26 22:40:36	    Page 4
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/11/26"
??FILENAME			  Text	 "vram	  "
??TIME				  Text	 "22:40:36"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 VRAM
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BLINKING			  Number 0080
BRT_RED_CLR			  Number 000C
DRAWFRAME			  Near	 DGROUP:0132
DRAWHORIZONTALLINE		  Near	 DGROUP:0157
DRAWVERTICALLINE		  Near	 DGROUP:015F
EVENLEN				  Near	 DGROUP:0125
FRAME_COLOR			  Number 000F
FRAME_HEIGHT			  Number 0006
FRAME_START_LINE		  Number 0005
FRAME_WIDTH			  Number 0028
HORIZ_LINE			  Number 00CD
LD_CORNER			  Number 00C8
LOADLINEEND			  Near	 DGROUP:012D
LOADSTRING			  Near	 DGROUP:0129
LU_CORNER			  Number 00C9
RD_CORNER			  Number 00BC
RU_CORNER			  Number 00BB
SCREEN_WIDTH			  Number 0050
START				  Near	 DGROUP:0100
VERTICALLINELOOP		  Near	 DGROUP:0164
VERT_LINE			  Number 00BA
VIDEO_SEG			  Number B800

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  016E Word	  Public  CODE
