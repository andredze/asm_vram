Turbo Assembler	 Version 4.1	    02/15/26 13:14:02	    Page 1
vram.asm



      1	0000			     .model tiny
      2	0000			     .code
      3
      4				     org 100h
      5
      6				     ;//------------------------------------------------------------------------------------------
      7
      8	      =0070		     BKGND_COLOR      equ 070h
      9	      =0050		     SCREEN_WIDTH     equ 80
     10	      =B800		     VIDEO_SEG		  equ 0b800h
     11
     12	      =0005		     FRAME_START_LINE equ 5
     13
     14	      =0000		     FRAME_COLOR	      equ 00h
     15	      =0028		     FRAME_WIDTH	      equ 40
     16	      =0006		     FRAME_HEIGHT     equ 6
     17
     18	      =00CD		     HORIZ_LINE		  equ 0cdh
     19	      =00BA		     VERT_LINE		  equ 0bah
     20	      =00C9		     LU_CORNER		  equ 0c9h
     21	      =00BB		     RU_CORNER		  equ 0bbh
     22	      =00C8		     LD_CORNER		  equ 0c8h
     23	      =00BC		     RD_CORNER		  equ 0bch
     24
     25	      =000C		     BRT_RED_CLR	  equ 0ch
     26	      =0080		     BLINKING		  equ 80h
     27
     28				     ;//------------------------------------------------------------------------------------------
     29
     30	0100			     Start:
     31	0100  E8 0003			     call Main
     32	0103  E8 0095			     call Exit
     33
     34				     ;//==========================================================================================
     35
     36	0106			     Main    proc
     37	0106  B8 B800			     mov ax, VIDEO_SEG				     ; b800h - segment of vram
     38	0109  8E C0				     mov es, ax						     ; es - extended segment
     39
     40					     ; di = (center of start line)
     41	010B  BF 0370				     mov di, (2	* SCREEN_WIDTH * FRAME_START_LINE + SCREEN_WIDTH)
     42
     43	010E  57			     push di
     44	010F  E8 000E			     call DrawFrame
     45	0112  5F			     pop di
     46
     47	0113  57			     push di
     48
     49	0114  81 C7 0140			     add di, (2	* SCREEN_WIDTH * ((FRAME_HEIGHT	- 1) / 2))   ;
     50
     51	0118  E8 0063			     call PrintCmdLine
     52
     53	011B  5F			     pop di
     54	011C  E8 0026			     call DrawFrameBackground
     55	011F  C3			     ret
     56	0120				     endp
     57
Turbo Assembler	 Version 4.1	    02/15/26 13:14:02	    Page 2
vram.asm



     58				     ;--------------------------------------------------------------------------------
     59				     ; function	should get di:
     60				     ; di = position in	vram in	the center of the DOS screen, where frame should start
     61				     ; ax, cx, di doesn't save their values
     62				     ;--------------------------------------------------------------------------------
     63
     64	0120			     DrawFrame	 proc
     65
     66					 ; move	to the left side (a half of frame width)
     67					 ; not div 2, because 1	symbol = 2 bytes in vram
     68	0120  83 EF 28			 sub di, FRAME_WIDTH
     69
     70					 ; 2nd ax byte = color in vram
     71	0123  B4 00			 mov ah, FRAME_COLOR
     72
     73	0125  B0 C9			 mov al, LU_CORNER
     74	0127  AB			 stosw
     75
     76	0128  E8 003C			 call DrawHorizontalLine
     77
     78	012B  B0 BB			 mov al, RU_CORNER
     79	012D  AB			 stosw
     80
     81					 ; move	back to	the left side
     82					 ; and go to newline to	skip corner
     83	012E  83 C7 50			 add di, (-FRAME_WIDTH * 2 + SCREEN_WIDTH * 2)
     84
     85	0131  E8 003B			 call DrawVerticalLine
     86
     87	0134  B0 C8			 mov al, LD_CORNER
     88	0136  AB			 stosw
     89
     90	0137  E8 002D			 call DrawHorizontalLine
     91
     92	013A  B0 BC			 mov al, RD_CORNER
     93	013C  AB			 stosw
     94
     95					 ; +2 to get in	front of the corner
     96					 ; move	up below the right corner
     97					 ; -2 of height	to skip	the upper corner
     98	013D  81 EF 0282		 sub di, (2 + SCREEN_WIDTH * 2 * (FRAME_HEIGHT - 2))
     99
    100	0141  E8 002B			 call DrawVerticalLine
    101
    102	0144  C3			 ret
    103	0145				 endp
    104
    105				     ;//------------------------------------------------------------------------------------------
    106
    107	0145			     DrawFrameBackground     proc
    108
    109					 ; move	to the left side (a half of frame width)
    110					 ; not div 2, because 1	symbol = 2 bytes in vram
    111	0145  83 EF 28			 sub di, FRAME_WIDTH
    112
    113					 ; si =	iterator for lines
    114	0148  BE 0006			 mov si, FRAME_HEIGHT
Turbo Assembler	 Version 4.1	    02/15/26 13:14:02	    Page 3
vram.asm



    115
    116	014B			     DrawBkgndLoop:
    117
    118					 ; cx =	iterator for columns
    119	014B  B9 0028			 mov cx, FRAME_WIDTH
    120
    121	014E				 DrawBkgndLineLoop:
    122
    123	014E  26: 80 65	01 AF		     and byte ptr es:[di + 1], 0afh
    124	0153  26: 80 4D	01 70		     or	 byte ptr es:[di + 1], BKGND_COLOR
    125
    126	0158  83 C7 02			     add di, 2
    127
    128	015B  E2 F1			 loop DrawBkgndLineLoop
    129
    130	015D  83 C7 50			 add di, (2 * (SCREEN_WIDTH - FRAME_WIDTH))
    131
    132	0160  4E			 dec si
    133	0161  83 FE 00			 cmp si, 0
    134	0164  75 E5			 jnz DrawBkgndLoop
    135
    136	0166  C3			 ret
    137	0167				 endp
    138
    139				     ;//------------------------------------------------------------------------------------------
    140
    141	0167			     DrawHorizontalLine	 proc
    142
    143					 ; 1st ax byte = symbol
    144	0167  B0 CD			 mov al, HORIZ_LINE
    145	0169  B9 0026			 mov cx, (FRAME_WIDTH -	2)
    146	016C  F3> AB			 rep stosw
    147
    148	016E  C3			 ret
    149	016F				 endp
    150
    151				     ;//------------------------------------------------------------------------------------------
    152
    153	016F			     DrawVerticalLine	 proc
    154
    155					 ; 1st ax byte = symbol
    156	016F  B0 BA			 mov al, VERT_LINE
    157	0171  B9 0004			 mov cx, (FRAME_HEIGHT - 2)
    158
    159	0174				 VerticalLineLoop:
    160	0174  26: 89 05			 mov es:[di], ax
    161	0177  81 C7 00A0		 add di, (SCREEN_WIDTH * 2)
    162
    163	017B  E2 F7			 loop VerticalLineLoop
    164
    165	017D  C3			 ret
    166	017E				 endp
    167
    168				     ;//==========================================================================================
    169
    170	017E			     PrintCmdLine    proc
    171
Turbo Assembler	 Version 4.1	    02/15/26 13:14:02	    Page 4
vram.asm



    172				     ; get cmd line
    173
    174					     ; CX = CmdTailLen - 1 (for	the last \r)
    175	017E  BE 0080			     mov si, 80h
    176	0181  8A 0C			     mov byte ptr cl, [si]
    177
    178					     ; if CmdTailLen ==	0 -> jump to the end
    179	0183  E3 15			     jcxz PrintCmdLineEnd
    180
    181	0185  49			     dec cx
    182
    183					     ; SI = &CmdTail
    184	0186  BE 0082			     mov si, 82h
    185
    186				     ;//------------------------------------------------------------------------------------------
    187				     ; center the text
    188
    189					     ; BX = shift to the left
    190					     ; BX = StringLen
    191	0189  8B D9			     mov bx, cx
    192
    193					     ; if CmdTailLen is	odd: bx++ (shift one more)
    194	018B  F7 C3 0001		     test bx, 01h
    195	018F  74 01			     jz	EvenLen
    196	0191  43			     inc bx
    197	0192				 EvenLen:
    198							     ; no need to div by 2, as there are 2 bytes in vram
    199	0192  2B FB				     sub di, bx		     ; di = center - shift
    200
    201				     ;//------------------------------------------------------------------------------------------
    202				     ; load the	text
    203
    204					     ; 2nd ax byte = color in vram
    205	0194  B4 8C			     mov ah, (BRT_RED_CLR or BLINKING)
    206
    207	0196				 LoadString:
    208
    209	0196  AC			     lodsb
    210	0197  AB			     stosw
    211
    212	0198  E2 FC			     loop LoadString
    213
    214	019A				 PrintCmdLineEnd:
    215
    216	019A  C3			 ret
    217	019B				 endp
    218
    219				     ;--------------------------------------------------------------------------------
    220				     ; Short:	ends the program
    221				     ; Exp:	-
    222				     ; In:	-
    223				     ; Out:	-
    224				     ; Destroy:	ax
    225				     ;--------------------------------------------------------------------------------
    226
    227	019B			     Exit    proc
    228	019B  B8 4C00				     mov ax, 4c00h   ; exit(0)
Turbo Assembler	 Version 4.1	    02/15/26 13:14:02	    Page 5
vram.asm



    229	019E  CD 21				     int 21h		     ; int for DOS func	call
    230	01A0  C3			     ret
    231	01A1				     endp
    232
    233				     ;================================================================================
    234
    235				     end	     Start
Turbo Assembler	 Version 4.1	    02/15/26 13:14:02	    Page 6
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/15/26"
??FILENAME			  Text	 "vram	  "
??TIME				  Text	 "13:14:01"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 VRAM
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BKGND_COLOR			  Number 0070
BLINKING			  Number 0080
BRT_RED_CLR			  Number 000C
DRAWBKGNDLINELOOP		  Near	 DGROUP:014E
DRAWBKGNDLOOP			  Near	 DGROUP:014B
DRAWFRAME			  Near	 DGROUP:0120
DRAWFRAMEBACKGROUND		  Near	 DGROUP:0145
DRAWHORIZONTALLINE		  Near	 DGROUP:0167
DRAWVERTICALLINE		  Near	 DGROUP:016F
EVENLEN				  Near	 DGROUP:0192
EXIT				  Near	 DGROUP:019B
FRAME_COLOR			  Number 0000
FRAME_HEIGHT			  Number 0006
FRAME_START_LINE		  Number 0005
FRAME_WIDTH			  Number 0028
HORIZ_LINE			  Number 00CD
LD_CORNER			  Number 00C8
LOADSTRING			  Near	 DGROUP:0196
LU_CORNER			  Number 00C9
MAIN				  Near	 DGROUP:0106
PRINTCMDLINE			  Near	 DGROUP:017E
PRINTCMDLINEEND			  Near	 DGROUP:019A
RD_CORNER			  Number 00BC
RU_CORNER			  Number 00BB
SCREEN_WIDTH			  Number 0050
START				  Near	 DGROUP:0100
VERTICALLINELOOP		  Near	 DGROUP:0174
VERT_LINE			  Number 00BA
VIDEO_SEG			  Number B800

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  01A1 Word	  Public  CODE
