Turbo Assembler	 Version 4.1	    02/11/26 11:10:51	    Page 1
frame.asm



      1	0000			     .model tiny
      2	0000			     .code
      3
      4				     org 100h
      5
      6				     ;//------------------------------------------------------------------------------------------
      7
      8	      =000F		     FRAME_COLOR	     equ 0Fh
      9	      =0028		     FRAME_WIDTH	     equ 40
     10	      =0005		     FRAME_HEIGHT    equ 5
     11
     12	      =00CD		     HORIZ_LINE	     equ 0cdh
     13	      =00BA		     VERT_LINE	     equ 0bah
     14	      =00C9		     LUCORNER	     equ 0c9h
     15	      =00BB		     RUCORNER	     equ 0bbh
     16	      =00C8		     LDCORNER	     equ 0c8h
     17	      =00BC		     RDCORNER	     equ 0bch
     18
     19	      =000C		     BRT_RED_CLR     equ 0ch
     20	      =0080		     BLINKING	     equ 80h
     21	      =B800		     VIDEO_SEG	     equ 0b800h
     22
     23				     ;//------------------------------------------------------------------------------------------
     24
     25	0100			     Start:
     26				     ;	     go	to the segment
     27	0100  B8 B800				     mov ax, VIDEO_SEG				     ; b800h - segment of vram
     28	0103  8E C0				     mov es, ax						     ; es - extended segment
     29
     30				     ;//------------------------------------------------------------------------------------------
     31
     32				     ;	     center the	first line of frame
     33	0105  BB 0370				     mov bx, (2	* 80 * 5 + 2 * 40)   ; bx = (center of 5th line)
     34	0108  83 EB 28				     sub bx, FRAME_WIDTH	     ; center the frame
     35	010B  B9 0026				     mov cx, FRAME_WIDTH - 2 ; -2 for corners
     36
     37	010E  B4 0F				     mov ah, FRAME_COLOR
     38	0110  B0 C9				     mov al, LUCORNER
     39
     40	0112  26: 89 07				     mov es:[bx], ax
     41	0115  83 C3 02				     add bx, 2
     42
     43	0118  B0 CD				     mov al, HORIZ_LINE
     44
     45				     ;	     DRAW horizontal line
     46
     47	011A			     L_HORIZ_START:
     48	011A  26: 89 07				     mov es:[bx], ax
     49	011D  83 C3 02				     add bx, 2
     50
     51	0120  E2 F8				     loop L_HORIZ_START
     52
     53	0122  B0 BB				     mov al, RUCORNER
     54
     55	0124  26: 89 07				     mov es:[bx], ax
     56	0127  83 C3 02				     add bx, 2
     57
Turbo Assembler	 Version 4.1	    02/11/26 11:10:51	    Page 2
frame.asm



     58				     ;//------------------------------------------------------------------------------------------
     59
     60				     ;	     DRAW vertical lhs
     61	012A  83 C3 50				     add bx, ((80 - FRAME_WIDTH) * 2) ;	newline	+ move to the left side	of a frame
     62	012D  B0 BA				     mov al, VERT_LINE
     63	012F  26: 89 07				     mov es:[bx], ax
     64
     65				     ;	     DRAW vertical rhs
     66	0132  83 C3 4E				     add bx, ((FRAME_WIDTH - 1)	* 2) ; move to the right side of a frame
     67														     ; (-1 for the  +
     68				     side)
     69	0135  B0 BA				     mov al, VERT_LINE
     70	0137  26: 89 07				     mov es:[bx], ax
     71
     72				     ;//------------------------------------------------------------------------------------------
     73
     74	013A  83 EB 26				     sub bx, (FRAME_WIDTH - 2)	     ; move to the center of DOS window
     75													     ; (-2 to get back to   +
     76				     the start of side)
     77
     78				     ;	     center the	text
     79
     80	013D  BE 0080				     mov si, 80h
     81	0140  8A 0C				     mov byte ptr cl, [si]   ; CX = CmdTailLen (-1 for \r)
     82	0142  83 E9 01				     sub cx, 1
     83	0145  BF 0082				     mov di, 82h	     ; DI = &CmdTail
     84
     85	0148  8B F1				     mov si, cx		     ; si = CmdTailLen
     86
     87				     ;	     if	CmdTailLen is odd
     88	014A  F7 C6 0001			     test si, 01h
     89
     90	014E  74 01				     jz	EVEN_NUMBER
     91	0150  46				     inc si		     ; if the number is	odd -> move 1 byte more	left
     92	0151			     EVEN_NUMBER:
     93
     94										     ; no need to div by 2, as there are 2 bytes in +
     95				     vram
     96	0151  2B DE				     sub bx, si		     ; center the CmdLine
     97
     98				     ;//------------------------------------------------------------------------------------------
     99
    100				     ;	     print the text
    101
    102	0153  E3 12				     jcxz PRINT_LINE_END
    103
    104	0155			     PRINT_LINE_LOOP:
    105	0155  8A 05				     mov al, [di]
    106
    107						     ; put symbol in first byte
    108						     ; put color in second byte
    109
    110	0157  26: 88 07				     mov byte ptr es:[bx], al
    111	015A  26: C6 47	01 8C			     mov byte ptr es:[bx + 01],	(BRT_RED_CLR or	BLINKING)
    112						     ; brt red with blinking
    113
    114	015F  83 C3 02				     add bx, 2		     ; go to the next symbol in	vram
Turbo Assembler	 Version 4.1	    02/11/26 11:10:51	    Page 3
frame.asm



    115	0162  83 C7 01				     add di, 1		     ; get next	symbol
    116
    117	0165  E2 EE				     loop PRINT_LINE_LOOP    ; jmp back	if cx is not 0
    118
    119	0167			     PRINT_LINE_END:
    120
    121				     ;//------------------------------------------------------------------------------------------
    122
    123				     ;	     move to the center	for the	second frame line
    124
    125	0167  03 DE				     add bx, si
    126	0169  BF 0080				     mov di, 80h
    127	016C  8A 0D				     mov byte ptr cl, [di]
    128	016E  D1 E1				     shl cx, 1
    129	0170  2B D9				     sub bx, cx
    130	0172  83 C3 02				     add bx, 2
    131
    132				     ;//------------------------------------------------------------------------------------------
    133
    134				     ;	     DRAW the second line
    135
    136	0175  83 C3 78				     add bx, 80	* 2 - FRAME_WIDTH	     ; TODO: * amount of \n
    137
    138	0178  33 C9				     xor cx, cx
    139	017A  B9 0026				     mov cx, FRAME_WIDTH - 2			     ; -2 for corners
    140
    141	017D  B4 0F				     mov ah, FRAME_COLOR
    142
    143	017F  B0 C8				     mov al, LDCORNER
    144	0181  26: 89 07				     mov es:[bx], ax
    145	0184  83 C3 02				     add bx, 2
    146
    147	0187  B0 CD				     mov al, HORIZ_LINE
    148
    149						     ; DRAW horizontal line
    150
    151	0189			     L_HORIZ_END:
    152	0189  26: 89 07				     mov es:[bx], ax
    153	018C  83 C3 02				     add bx, 2
    154
    155	018F  E2 F8				     loop L_HORIZ_END
    156
    157	0191  B0 BC				     mov al, RDCORNER
    158	0193  26: 89 07				     mov es:[bx], ax
    159	0196  83 C3 02				     add bx, 2
    160
    161				     ;//------------------------------------------------------------------------------------------
    162
    163				     ;	     end program
    164	0199  B8 4C00				     mov ax, 4c00h   ; exit(0)
    165	019C  CD 21				     int 21h		     ; int for DOS func	call
    166
    167				     end	     Start
Turbo Assembler	 Version 4.1	    02/11/26 11:10:51	    Page 4
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/11/26"
??FILENAME			  Text	 "frame	  "
??TIME				  Text	 "11:10:51"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 FRAME
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BLINKING			  Number 0080
BRT_RED_CLR			  Number 000C
EVEN_NUMBER			  Near	 DGROUP:0151
FRAME_COLOR			  Number 000F
FRAME_HEIGHT			  Number 0005
FRAME_WIDTH			  Number 0028
HORIZ_LINE			  Number 00CD
LDCORNER			  Number 00C8
LUCORNER			  Number 00C9
L_HORIZ_END			  Near	 DGROUP:0189
L_HORIZ_START			  Near	 DGROUP:011A
PRINT_LINE_END			  Near	 DGROUP:0167
PRINT_LINE_LOOP			  Near	 DGROUP:0155
RDCORNER			  Number 00BC
RUCORNER			  Number 00BB
START				  Near	 DGROUP:0100
VERT_LINE			  Number 00BA
VIDEO_SEG			  Number B800

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  019E Word	  Public  CODE
